"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const RoomState_1 = require("../../../RoomState");
const AnimationJoueur_1 = require("../../Animations/AnimationJoueur");
const Balle_1 = require("./Balle");
class OieClass extends Phaser.Physics.Arcade.Sprite {
    constructor(scene, x, y, sprite, ClientID, flipX, cible) {
        super(scene, x, y, sprite);
        this.vel = 400;
        this.proprietaire = '';
        this.sprite = 'troll';
        this._frame = 'attack0';
        this.vitesse = 0;
        this.puissance = 0;
        this.init(scene, ClientID, flipX, cible);
    }
    init(scene, id, flipX, cible) {
        this.scene = scene;
        scene.physics.add.existing(this);
        this.id = id;
        this.scene.physics.add.collider(this.scene.platforme_haut_gauche, this);
        //@ts-ignore
        this.scene.physics.add.collider([this.scene.platforme, this.scene.platforme_droite, this.scene.platforme_gauche, this.scene.platforme_haut, this.scene.platforme_haut_gauche, this.scene.platforme_haut_droite], this);
        new AnimationJoueur_1.AnimationOie(this.anims);
        this.setFlipX(flipX);
        this.setScale(1.5);
        this.play('oie_tire');
        this.setSize(this.width - 20, 100);
        // scene.suppressionProjectileDelai(this, id, 1400, true)
        this.scene.room.state.projectiles.set(this.id, new RoomState_1.Projectile({
            x: this.x,
            y: this.y,
            id: this.id,
            anim: this.anims.getFrameName(),
            sprite: this.sprite,
            flipX: this.flipX,
            scale: this.scale,
            _frame: this._frame
        }));
        this.scene.suppressionProjectileDelai(this, id, 1300, true);
        this.on(Phaser.Animations.Events.ANIMATION_UPDATE, function (_anim, frame) {
            if (frame.frame.name == 'attack3') {
                const idBalle = `${(Math.random() + 1).toString(36).substring(7)}`;
                const balle = this.scene.add.existing(new Balle_1.Balle(this.scene, this.x, this.y - 30, 'balle', idBalle, this.flipX, cible));
                this.scene.physics.add.existing(balle);
                this.scene.suppressionProjectileDelai(balle, idBalle, 700, true);
            }
            if (frame.frame.name == 'attack4') {
                const idBalleInverse = `${(Math.random() + 1).toString(36).substring(7)}`;
                const balle = this.scene.add.existing(new Balle_1.Balle(this.scene, this.x, this.y - 30, 'balle', idBalleInverse, !this.flipX, cible));
                this.scene.physics.add.existing(balle);
                this.scene.suppressionProjectileDelai(balle, idBalleInverse, 700, true);
            }
        });
    }
    preUpdate(time, delta) {
        super.preUpdate(time, delta);
        this.setVelocityX(this.flipX ? -500 : 500);
        // if (this.frame.name === "attack4") {
        // }
        this.scene.room.state.projectiles.set(this.id, new RoomState_1.Projectile({
            x: this.x,
            y: this.y,
            alpha: this.alpha,
            id: this.id,
            anim: this.anims.getFrameName(),
            sprite: this.sprite,
            _frame: this._frame
        }));
    }
}
exports.default = OieClass;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2llQ2xhc3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvc2VydmVyL2dhbWUvc2NlbmVzL2NsYXNzL2VsZW1lbnRzL09pZUNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0RBQStDO0FBQy9DLHNFQUErRDtBQUMvRCxtQ0FBK0I7QUFFL0IsTUFBcUIsUUFBUyxTQUFRLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU07SUFXaEUsWUFDRSxLQUFtQixFQUNuQixDQUFTLEVBQ1QsQ0FBUyxFQUNULE1BQWMsRUFDZCxRQUFnQixFQUNoQixLQUFjLEVBQ2QsS0FBYTtRQUViLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQTtRQWxCNUIsUUFBRyxHQUFXLEdBQUcsQ0FBQTtRQUNqQixpQkFBWSxHQUFXLEVBQUUsQ0FBQTtRQUV6QixXQUFNLEdBQVcsT0FBTyxDQUFBO1FBQ3hCLFdBQU0sR0FBVyxTQUFTLENBQUE7UUFFMUIsWUFBTyxHQUFXLENBQUMsQ0FBQTtRQUNuQixjQUFTLEdBQVcsQ0FBQyxDQUFBO1FBYW5CLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFDMUMsQ0FBQztJQUVELElBQUksQ0FBQyxLQUFtQixFQUFFLEVBQVUsRUFBRSxLQUFjLEVBQUUsS0FBYTtRQUNqRSxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtRQUNsQixLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFakMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFFYixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFFLElBQUksQ0FBQyxLQUFhLENBQUMscUJBQXFCLEVB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